{% extends 'layout.html' %}
{% block title %}Diagnostic{% endblock %}
{% block body %}
<!-- Displays All Medecines Currently issued to Specific Patient if any -->
{% if data_testissue %}
<p class="text-white text-center" >Diagnostic Tests Issued to patient ID: {{pdata['pid']}} | Name : {{pdata['pname']}}</p>

<table class="table">
  <thead class="thead-dark">
    <tr>
      <th>Test ID</th>
      <th>Test Name</th>
      <th>Charge</th>
      <th>Test Done At:</th>

  </thead>
  </tr>
  {% for data in data_testissue %}
  <tbody>
    <tr>
      <td>{{data.testid}}</td>
      <td>{{data.testname}}</td>
      <td>{{data.charge}}</td>
      <td>{{data.created_on}}</td>
    </tr>
  </tbody>
  {% endfor %}
</table>

{% else %}
<div class="text-danger text-center">
  <h4>No Diagnostic Tests Issued to patient ID: {{pdata['pid']}} | Name : {{pdata['pname']}} found in the Records!</h4>
</div>
  

{% endif %}


<!-- end show issued medicine -->

<!-- show available medicines in the inventory from which pharmacist can issue meds
     to patient if inventory not empty -->

<div class="main">
  <button style="margin-left: 8vh;" class="btn btn-primary" id="bissuetestadd">Issue New Tests</button>
  <div class="row justify-content-center">
    <div class="col-md-8">
      {% if data_alltest %}
      <form action="/diagnostic/issuetest" method="post" class="text-white" onsubmit="return addvalidation()"
        id="issuenewtestform" style="display: none;">
        <div class="row justify-content-center">
          <div class="col-md-8">
            <div class="form-bg form-style-patient">
              <div class="row justify-content-center">
                <div class="col-md-12">
                  <h2>Issue Medicine</h2><br />
                </div>
              </div>
              <input type="hidden" name="pid" value="{{pdata['pid']}}" />
              <input type="hidden" name="pname" value="{{pdata['pname']}}" />

              <div class="form-group row justify-content-center">
                <label class="col-md-5 col-form-label">Select Diagnostic Test</label>
                <div class="col-md-6">
                  <select name="testname" class="form-control" id="testname" required>
                    <option value="" selected disabled>Select Test ....</option>
                    {% for data in data_alltest %}
                    <option value="{{data}}" id=>{{data}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="form-group row justify-content-center">
                <label class="col-md-5 col-form-label">Charge</label>
                <div class="col-md-6">
                  <input class="form-control" name="charge" id="charge" readonly type="number" step="0.0001" value= />
                </div>
              </div>

              <button class="btn btn-primary" name="submit" type="submit" value="issuetest_add">Confirm Add!</button>
              <button class="btn btn-warning" type="reset" value="Reset">Reset</button>
            </div>
          </div>
        </div>
      </form>
      <br>
      
<input style="margin-left: 8vh;" class="
btn btn-warning" type="button" value="Back" onclick="history.back()" />
      {% else %}
      <p>No Diagnostic Tests Facility is Available! Add Diagnostic Test Facility</p>
      {% endif %}
    </div>
  </div>
</div>




<!-- ============================= JS validataion=================== -->


<script>
  $(document).ready(function () {
    window.history.replaceState("", "", window.location.href);
  });
</script>

<script>
  $(document).ready(function () {
    $("#bissuetestadd").click(function () {
      $("#issuenewtestform").show();

    });
  });
</script>


<script>
  $(document).ready(function () {
    var data = JSON.parse('{{ data_alltest | tojson | safe}}');
    $(document).on('change', '#testname', function () {
      $('#charge').val(data[$(this).val()])
    });

  });
</script>



{% endblock %}